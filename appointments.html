<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Appointments List</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
  <div class="container mt-5">
    <h2>All Appointments</h2>
    <table class="table table-bordered" id="appointmentsTable">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Date</th>
          <th>Department</th>
          <th>Doctor</th>
          <th>Message</th>
          <th>Delete</th>
          <th>Edit</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id="error" class="text-danger mt-3"></div>
  </div>


  
 <script>
  // Fetch and display appointments
  async function fetchAppointments() {
    try {
      const response = await fetch('http://localhost:5000/api/appointments');
      const result = await response.json();

      const tableBody = document.querySelector('#appointmentsTable tbody');
      tableBody.innerHTML = ''; // Clear existing rows

      if (result.success && result.data.length > 0) {
        result.data.forEach(appointment => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${appointment.id}</td>
            <td>${appointment.name}</td>
            <td>${appointment.email}</td>
            <td>${appointment.phone}</td>
            <td>${new Date(appointment.date).toLocaleString()}</td>
            <td>${appointment.department}</td>
            <td>${appointment.doctor}</td>
            <td>${appointment.message || ''}</td>
            <td>
              <button class="btn btn-danger btn-sm" onclick="deleteAppointment(${appointment.id})">Delete</button>
            </td>
            <td>
             <a href="APIUPDATE.html?id=${appointment.id}" class="btn btn-primary btn-sm">Edit</a>
            </td>
          `;
          tableBody.appendChild(row);
        });
      } else {
        document.getElementById('error').textContent = "No appointments found.";
      }
    } catch (error) {
      console.error('Error fetching appointments:', error);
      document.getElementById('error').textContent = `Error: ${error.message}`;
    }
  }

  // Delete an appointment by ID
  async function deleteAppointment(id) {
    if (confirm("Are you sure you want to delete this appointment?")) {
      try {
        const response = await fetch(`http://localhost:5000/api/appointments/${id}`, {
          method: 'DELETE'
        });
        const result = await response.json();
        if (response.ok) {
          alert("Appointment deleted successfully");
          fetchAppointments(); // refresh table
        } else {
          alert(`Delete failed: ${result.error}`);
        }
      } catch (error) {
        alert(`Error deleting appointment: ${error.message}`);
      }
    }
  }

  // Load appointments on page load
  window.onload = fetchAppointments;
</script>




</body>
</html>
